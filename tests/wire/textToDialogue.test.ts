// This file was auto-generated by Fern from our API Definition.

import { ElevenLabsClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("TextToDialogueClient", () => {
    test("convert_with_timestamps", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            inputs: [
                { text: "Hello, how are you?", voice_id: "bYTqZQo3Jz7LQtmGTgwi" },
                { text: "I'm doing well, thank you!", voice_id: "6lCwbsX1yVjD49QmpkTR" },
            ],
        };
        const rawResponseBody = {
            audio_base64: "base64_encoded_audio_string",
            alignment: {
                characters: ["H", "e", "l", "l", "o", "H", "i"],
                character_start_times_seconds: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
                character_end_times_seconds: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
            },
            normalized_alignment: {
                characters: ["H", "e", "l", "l", "o", "H", "i"],
                character_start_times_seconds: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
                character_end_times_seconds: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
            },
            voice_segments: [
                {
                    voice_id: "21m00Tcm4TlvDq8ikWAM",
                    start_time_seconds: 0,
                    end_time_seconds: 0.5,
                    character_start_index: 0,
                    character_end_index: 5,
                    dialogue_input_index: 0,
                },
                {
                    voice_id: "VEDscrYI8uIMttlO2Ztu",
                    start_time_seconds: 0.5,
                    end_time_seconds: 0.7,
                    character_start_index: 5,
                    character_end_index: 7,
                    dialogue_input_index: 1,
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/v1/text-to-dialogue/with-timestamps")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.textToDialogue.convertWithTimestamps({
            outputFormat: "alaw_8000",
            inputs: [
                {
                    text: "Hello, how are you?",
                    voiceId: "bYTqZQo3Jz7LQtmGTgwi",
                },
                {
                    text: "I'm doing well, thank you!",
                    voiceId: "6lCwbsX1yVjD49QmpkTR",
                },
            ],
        });
        expect(response).toEqual({
            audioBase64: "base64_encoded_audio_string",
            alignment: {
                characters: ["H", "e", "l", "l", "o", "H", "i"],
                characterStartTimesSeconds: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
                characterEndTimesSeconds: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
            },
            normalizedAlignment: {
                characters: ["H", "e", "l", "l", "o", "H", "i"],
                characterStartTimesSeconds: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
                characterEndTimesSeconds: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
            },
            voiceSegments: [
                {
                    voiceId: "21m00Tcm4TlvDq8ikWAM",
                    startTimeSeconds: 0,
                    endTimeSeconds: 0.5,
                    characterStartIndex: 0,
                    characterEndIndex: 5,
                    dialogueInputIndex: 0,
                },
                {
                    voiceId: "VEDscrYI8uIMttlO2Ztu",
                    startTimeSeconds: 0.5,
                    endTimeSeconds: 0.7,
                    characterStartIndex: 5,
                    characterEndIndex: 7,
                    dialogueInputIndex: 1,
                },
            ],
        });
    });
});
