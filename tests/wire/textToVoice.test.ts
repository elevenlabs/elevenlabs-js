/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { ElevenLabsClient } from "../../src/Client";

describe("TextToVoice", () => {
    test("create_previews", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { voice_description: "A sassy squeaky mouse" };
        const rawResponseBody = {
            previews: [
                {
                    audio_base_64: "audio_base_64",
                    generated_voice_id: "generated_voice_id",
                    media_type: "media_type",
                    duration_secs: 1.1,
                    language: "language",
                },
            ],
            text: "text",
        };
        server
            .mockEndpoint()
            .post("/v1/text-to-voice/create-previews")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.textToVoice.createPreviews({
            outputFormat: "mp3_22050_32",
            voiceDescription: "A sassy squeaky mouse",
        });
        expect(response).toEqual({
            previews: [
                {
                    audioBase64: "audio_base_64",
                    generatedVoiceId: "generated_voice_id",
                    mediaType: "media_type",
                    durationSecs: 1.1,
                    language: "language",
                },
            ],
            text: "text",
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            voice_name: "Sassy squeaky mouse",
            voice_description: "A sassy squeaky mouse",
            generated_voice_id: "37HceQefKmEi3bGovXjL",
        };
        const rawResponseBody = {
            voice_id: "21m00Tcm4TlvDq8ikWAM",
            name: "Rachel",
            samples: [
                {
                    sample_id: "DCwhRBWXzGAHq8TQ4Fs18",
                    file_name: "sample.mp3",
                    mime_type: "audio/mpeg",
                    size_bytes: 1000000,
                    hash: "1234567890",
                    duration_secs: 1.1,
                    remove_background_noise: true,
                    has_isolated_audio: true,
                    has_isolated_audio_preview: true,
                    speaker_separation: {
                        voice_id: "DCwhRBWXzGAHq8TQ4Fs18",
                        sample_id: "DCwhRBWXzGAHq8TQ4Fs18",
                        status: "not_started",
                    },
                    trim_start: 1,
                    trim_end: 1,
                },
            ],
            category: "professional",
            fine_tuning: {
                is_allowed_to_fine_tune: true,
                state: { eleven_multilingual_v2: "fine_tuned" },
                verification_failures: ["verification_failures"],
                verification_attempts_count: 2,
                manual_verification_requested: false,
                language: "language",
                progress: { key: 1.1 },
                message: { key: "value" },
                dataset_duration_seconds: 1.1,
                verification_attempts: [
                    {
                        text: "Hello, how are you?",
                        date_unix: 1714204800,
                        accepted: true,
                        similarity: 0.95,
                        levenshtein_distance: 2,
                        recording: {
                            recording_id: "CwhRBWXzGAHq8TQ4Fs17",
                            mime_type: "audio/mpeg",
                            size_bytes: 1000000,
                            upload_date_unix: 1714204800,
                            transcription: "Hello, how are you?",
                        },
                    },
                ],
                slice_ids: ["slice_ids"],
                manual_verification: {
                    extra_text: "Please verify the voice is that of a female.",
                    request_time_unix: 1714204800,
                    files: [
                        {
                            file_id: "CwhRBWXzGAHq8TQ4Fs18",
                            file_name: "file.mp3",
                            mime_type: "audio/mpeg",
                            size_bytes: 1000000,
                            upload_date_unix: 1714204800,
                        },
                    ],
                },
                max_verification_attempts: 1,
                next_max_verification_attempts_reset_unix_ms: 1,
                finetuning_state: { key: "value" },
            },
            labels: {
                accent: "American",
                age: "middle-aged",
                description: "expressive",
                gender: "female",
                use_case: "social media",
            },
            description: "A warm, expressive voice with a touch of humor.",
            preview_url:
                "https://storage.googleapis.com/eleven-public-prod/premade/voices/9BWtsMINqrJLrRacOk9x/405766b8-1f4e-4d3c-aba1-6f25333823ec.mp3",
            available_for_tiers: ["creator", "enterprise"],
            settings: { stability: 1, use_speaker_boost: true, similarity_boost: 1, style: 0, speed: 1 },
            sharing: {
                status: "enabled",
                history_item_sample_id: "DCwhRBWXzGAHq8TQ4Fs18",
                date_unix: 1714204800,
                whitelisted_emails: ["example@example.com"],
                public_owner_id: "DCwhRBWXzGAHq8TQ4Fs18",
                original_voice_id: "DCwhRBWXzGAHq8TQ4Fs18",
                financial_rewards_enabled: true,
                free_users_allowed: true,
                live_moderation_enabled: true,
                rate: 0.05,
                fiat_rate: 1.1,
                notice_period: 30,
                disable_at_unix: 1714204800,
                voice_mixing_allowed: false,
                featured: true,
                category: "professional",
                reader_app_enabled: true,
                image_url: "image_url",
                ban_reason: "ban_reason",
                liked_by_count: 100,
                cloned_by_count: 50,
                name: "Rachel",
                description: "A female voice with a soft and friendly tone.",
                labels: { accent: "American", gender: "female" },
                review_status: "allowed",
                review_message: "review_message",
                enabled_in_library: true,
                instagram_username: "instagram_username",
                twitter_username: "twitter_username",
                youtube_username: "youtube_username",
                tiktok_username: "tiktok_username",
                moderation_check: {
                    date_checked_unix: 1714204800,
                    name_value: "Rachel",
                    name_check: true,
                    description_value: "A female voice with a soft and friendly tone.",
                    description_check: true,
                    sample_ids: ["sample1", "sample2"],
                    sample_checks: [0.95, 0.98],
                    captcha_ids: ["captcha1", "captcha2"],
                    captcha_checks: [0.95, 0.98],
                },
                reader_restricted_on: [{ resource_type: "read", resource_id: "FCwhRBWXzGAHq8TQ4Fs18" }],
            },
            high_quality_base_model_ids: [
                "eleven_v2_flash",
                "eleven_flash_v2",
                "eleven_turbo_v2_5",
                "eleven_multilingual_v2",
                "eleven_v2_5_flash",
                "eleven_flash_v2_5",
                "eleven_turbo_v2",
            ],
            verified_languages: [
                {
                    language: "en",
                    model_id: "eleven_multilingual_v2",
                    accent: "american",
                    locale: "en-US",
                    preview_url:
                        "https://storage.googleapis.com/eleven-public-prod/premade/voices/9BWtsMINqrJLrRacOk9x/405766b8-1f4e-4d3c-aba1-6f25333823ec.mp3",
                },
            ],
            safety_control: "NONE",
            voice_verification: {
                requires_verification: false,
                is_verified: true,
                verification_failures: ["verification_failures"],
                verification_attempts_count: 0,
                language: "en",
                verification_attempts: [
                    {
                        text: "Hello, how are you?",
                        date_unix: 1714204800,
                        accepted: true,
                        similarity: 0.95,
                        levenshtein_distance: 2,
                        recording: {
                            recording_id: "CwhRBWXzGAHq8TQ4Fs17",
                            mime_type: "audio/mpeg",
                            size_bytes: 1000000,
                            upload_date_unix: 1714204800,
                            transcription: "Hello, how are you?",
                        },
                    },
                ],
            },
            permission_on_resource: "permission_on_resource",
            is_owner: false,
            is_legacy: false,
            is_mixed: false,
            favorited_at_unix: 1,
            created_at_unix: 1,
        };
        server
            .mockEndpoint()
            .post("/v1/text-to-voice")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.textToVoice.create({
            voiceName: "Sassy squeaky mouse",
            voiceDescription: "A sassy squeaky mouse",
            generatedVoiceId: "37HceQefKmEi3bGovXjL",
        });
        expect(response).toEqual({
            voiceId: "21m00Tcm4TlvDq8ikWAM",
            name: "Rachel",
            samples: [
                {
                    sampleId: "DCwhRBWXzGAHq8TQ4Fs18",
                    fileName: "sample.mp3",
                    mimeType: "audio/mpeg",
                    sizeBytes: 1000000,
                    hash: "1234567890",
                    durationSecs: 1.1,
                    removeBackgroundNoise: true,
                    hasIsolatedAudio: true,
                    hasIsolatedAudioPreview: true,
                    speakerSeparation: {
                        voiceId: "DCwhRBWXzGAHq8TQ4Fs18",
                        sampleId: "DCwhRBWXzGAHq8TQ4Fs18",
                        status: "not_started",
                    },
                    trimStart: 1,
                    trimEnd: 1,
                },
            ],
            category: "professional",
            fineTuning: {
                isAllowedToFineTune: true,
                state: {
                    eleven_multilingual_v2: "fine_tuned",
                },
                verificationFailures: ["verification_failures"],
                verificationAttemptsCount: 2,
                manualVerificationRequested: false,
                language: "language",
                progress: {
                    key: 1.1,
                },
                message: {
                    key: "value",
                },
                datasetDurationSeconds: 1.1,
                verificationAttempts: [
                    {
                        text: "Hello, how are you?",
                        dateUnix: 1714204800,
                        accepted: true,
                        similarity: 0.95,
                        levenshteinDistance: 2,
                        recording: {
                            recordingId: "CwhRBWXzGAHq8TQ4Fs17",
                            mimeType: "audio/mpeg",
                            sizeBytes: 1000000,
                            uploadDateUnix: 1714204800,
                            transcription: "Hello, how are you?",
                        },
                    },
                ],
                sliceIds: ["slice_ids"],
                manualVerification: {
                    extraText: "Please verify the voice is that of a female.",
                    requestTimeUnix: 1714204800,
                    files: [
                        {
                            fileId: "CwhRBWXzGAHq8TQ4Fs18",
                            fileName: "file.mp3",
                            mimeType: "audio/mpeg",
                            sizeBytes: 1000000,
                            uploadDateUnix: 1714204800,
                        },
                    ],
                },
                maxVerificationAttempts: 1,
                nextMaxVerificationAttemptsResetUnixMs: 1,
                finetuningState: {
                    key: "value",
                },
            },
            labels: {
                accent: "American",
                age: "middle-aged",
                description: "expressive",
                gender: "female",
                use_case: "social media",
            },
            description: "A warm, expressive voice with a touch of humor.",
            previewUrl:
                "https://storage.googleapis.com/eleven-public-prod/premade/voices/9BWtsMINqrJLrRacOk9x/405766b8-1f4e-4d3c-aba1-6f25333823ec.mp3",
            availableForTiers: ["creator", "enterprise"],
            settings: {
                stability: 1,
                useSpeakerBoost: true,
                similarityBoost: 1,
                style: 0,
                speed: 1,
            },
            sharing: {
                status: "enabled",
                historyItemSampleId: "DCwhRBWXzGAHq8TQ4Fs18",
                dateUnix: 1714204800,
                whitelistedEmails: ["example@example.com"],
                publicOwnerId: "DCwhRBWXzGAHq8TQ4Fs18",
                originalVoiceId: "DCwhRBWXzGAHq8TQ4Fs18",
                financialRewardsEnabled: true,
                freeUsersAllowed: true,
                liveModerationEnabled: true,
                rate: 0.05,
                fiatRate: 1.1,
                noticePeriod: 30,
                disableAtUnix: 1714204800,
                voiceMixingAllowed: false,
                featured: true,
                category: "professional",
                readerAppEnabled: true,
                imageUrl: "image_url",
                banReason: "ban_reason",
                likedByCount: 100,
                clonedByCount: 50,
                name: "Rachel",
                description: "A female voice with a soft and friendly tone.",
                labels: {
                    accent: "American",
                    gender: "female",
                },
                reviewStatus: "allowed",
                reviewMessage: "review_message",
                enabledInLibrary: true,
                instagramUsername: "instagram_username",
                twitterUsername: "twitter_username",
                youtubeUsername: "youtube_username",
                tiktokUsername: "tiktok_username",
                moderationCheck: {
                    dateCheckedUnix: 1714204800,
                    nameValue: "Rachel",
                    nameCheck: true,
                    descriptionValue: "A female voice with a soft and friendly tone.",
                    descriptionCheck: true,
                    sampleIds: ["sample1", "sample2"],
                    sampleChecks: [0.95, 0.98],
                    captchaIds: ["captcha1", "captcha2"],
                    captchaChecks: [0.95, 0.98],
                },
                readerRestrictedOn: [
                    {
                        resourceType: "read",
                        resourceId: "FCwhRBWXzGAHq8TQ4Fs18",
                    },
                ],
            },
            highQualityBaseModelIds: [
                "eleven_v2_flash",
                "eleven_flash_v2",
                "eleven_turbo_v2_5",
                "eleven_multilingual_v2",
                "eleven_v2_5_flash",
                "eleven_flash_v2_5",
                "eleven_turbo_v2",
            ],
            verifiedLanguages: [
                {
                    language: "en",
                    modelId: "eleven_multilingual_v2",
                    accent: "american",
                    locale: "en-US",
                    previewUrl:
                        "https://storage.googleapis.com/eleven-public-prod/premade/voices/9BWtsMINqrJLrRacOk9x/405766b8-1f4e-4d3c-aba1-6f25333823ec.mp3",
                },
            ],
            safetyControl: "NONE",
            voiceVerification: {
                requiresVerification: false,
                isVerified: true,
                verificationFailures: ["verification_failures"],
                verificationAttemptsCount: 0,
                language: "en",
                verificationAttempts: [
                    {
                        text: "Hello, how are you?",
                        dateUnix: 1714204800,
                        accepted: true,
                        similarity: 0.95,
                        levenshteinDistance: 2,
                        recording: {
                            recordingId: "CwhRBWXzGAHq8TQ4Fs17",
                            mimeType: "audio/mpeg",
                            sizeBytes: 1000000,
                            uploadDateUnix: 1714204800,
                            transcription: "Hello, how are you?",
                        },
                    },
                ],
            },
            permissionOnResource: "permission_on_resource",
            isOwner: false,
            isLegacy: false,
            isMixed: false,
            favoritedAtUnix: 1,
            createdAtUnix: 1,
        });
    });

    test("design", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { voice_description: "A sassy squeaky mouse" };
        const rawResponseBody = {
            previews: [
                {
                    audio_base_64: "audio_base_64",
                    generated_voice_id: "generated_voice_id",
                    media_type: "media_type",
                    duration_secs: 1.1,
                    language: "language",
                },
            ],
            text: "text",
        };
        server
            .mockEndpoint()
            .post("/v1/text-to-voice/design")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.textToVoice.design({
            outputFormat: "mp3_22050_32",
            voiceDescription: "A sassy squeaky mouse",
        });
        expect(response).toEqual({
            previews: [
                {
                    audioBase64: "audio_base_64",
                    generatedVoiceId: "generated_voice_id",
                    mediaType: "media_type",
                    durationSecs: 1.1,
                    language: "language",
                },
            ],
            text: "text",
        });
    });

    test("remix", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { voice_description: "Make the voice have a higher pitch." };
        const rawResponseBody = {
            previews: [
                {
                    audio_base_64: "audio_base_64",
                    generated_voice_id: "generated_voice_id",
                    media_type: "media_type",
                    duration_secs: 1.1,
                    language: "language",
                },
            ],
            text: "text",
        };
        server
            .mockEndpoint()
            .post("/v1/text-to-voice/21m00Tcm4TlvDq8ikWAM/remix")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.textToVoice.remix("21m00Tcm4TlvDq8ikWAM", {
            outputFormat: "mp3_22050_32",
            voiceDescription: "Make the voice have a higher pitch.",
        });
        expect(response).toEqual({
            previews: [
                {
                    audioBase64: "audio_base_64",
                    generatedVoiceId: "generated_voice_id",
                    mediaType: "media_type",
                    durationSecs: 1.1,
                    language: "language",
                },
            ],
            text: "text",
        });
    });
});
