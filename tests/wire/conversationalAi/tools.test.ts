// This file was auto-generated by Fern from our API Definition.

import { mockServerPool } from "../../mock-server/MockServerPool";
import { ElevenLabsClient } from "../../../src/Client";

describe("Tools", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            tools: [
                {
                    id: "id",
                    tool_config: {
                        type: "api_integration_webhook",
                        name: "name",
                        description: "description",
                        response_timeout_secs: 1,
                        disable_interruptions: true,
                        force_pre_tool_speech: true,
                        assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                        tool_call_sound: undefined,
                        tool_call_sound_behavior: "auto",
                        dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                        execution_mode: "immediate",
                        tool_version: "tool_version",
                        api_integration_id: "api_integration_id",
                        api_integration_connection_id: "api_integration_connection_id",
                        api_schema_overrides: undefined,
                        base_api_schema: {
                            url: "https://example.com/agents/{agent_id}",
                            method: "GET",
                            path_params_schema: { agent_id: { type: "string", enum: undefined } },
                            query_params_schema: {
                                properties: {
                                    key: {
                                        type: "string",
                                        description: "My property",
                                        enum: undefined,
                                        is_system_provided: false,
                                        dynamic_variable: "",
                                        constant_value: "",
                                    },
                                },
                            },
                            request_body_schema: {},
                            request_headers: { Authorization: "Bearer {api_key}" },
                            auth_connection: undefined,
                        },
                    },
                    access_info: {
                        is_creator: true,
                        creator_name: "John Doe",
                        creator_email: "john.doe@example.com",
                        role: "admin",
                    },
                    usage_stats: { avg_latency_secs: 1.1 },
                },
            ],
        };
        server.mockEndpoint().get("/v1/convai/tools").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.conversationalAi.tools.list();
        expect(response).toEqual({
            tools: [
                {
                    id: "id",
                    toolConfig: {
                        type: "api_integration_webhook",
                        name: "name",
                        description: "description",
                        responseTimeoutSecs: 1,
                        disableInterruptions: true,
                        forcePreToolSpeech: true,
                        assignments: [
                            {
                                source: "response",
                                dynamicVariable: "user_name",
                                valuePath: "user.name",
                            },
                        ],
                        toolCallSound: undefined,
                        toolCallSoundBehavior: "auto",
                        dynamicVariables: {
                            dynamicVariablePlaceholders: {
                                user_name: "John Doe",
                            },
                        },
                        executionMode: "immediate",
                        toolVersion: "tool_version",
                        apiIntegrationId: "api_integration_id",
                        apiIntegrationConnectionId: "api_integration_connection_id",
                        apiSchemaOverrides: undefined,
                        baseApiSchema: {
                            url: "https://example.com/agents/{agent_id}",
                            method: "GET",
                            pathParamsSchema: {
                                agent_id: {
                                    type: "string",
                                    enum: undefined,
                                },
                            },
                            queryParamsSchema: {
                                properties: {
                                    key: {
                                        type: "string",
                                        description: "My property",
                                        enum: undefined,
                                        isSystemProvided: false,
                                        dynamicVariable: "",
                                        constantValue: "",
                                    },
                                },
                            },
                            requestBodySchema: {},
                            requestHeaders: {
                                Authorization: "Bearer {api_key}",
                            },
                            authConnection: undefined,
                        },
                    },
                    accessInfo: {
                        isCreator: true,
                        creatorName: "John Doe",
                        creatorEmail: "john.doe@example.com",
                        role: "admin",
                    },
                    usageStats: {
                        avgLatencySecs: 1.1,
                    },
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            tool_config: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                api_integration_id: "api_integration_id",
                api_integration_connection_id: "api_integration_connection_id",
                base_api_schema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    path_params_schema: { agent_id: { type: "string" } },
                    query_params_schema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                is_system_provided: false,
                                dynamic_variable: "",
                                constant_value: "",
                            },
                        },
                    },
                    request_body_schema: {},
                    request_headers: { Authorization: "Bearer {api_key}" },
                },
            },
        };
        const rawResponseBody = {
            id: "id",
            tool_config: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                disable_interruptions: true,
                force_pre_tool_speech: true,
                assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                tool_call_sound: "typing",
                tool_call_sound_behavior: "auto",
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                execution_mode: "immediate",
                tool_version: "tool_version",
                api_integration_id: "api_integration_id",
                api_integration_connection_id: "api_integration_connection_id",
                api_schema_overrides: {
                    path_params_schema: {},
                    query_params_schema: { properties: undefined, required: undefined },
                    request_body_schema: { description: undefined, properties: undefined, required: undefined },
                    request_headers: {},
                },
                base_api_schema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    path_params_schema: { agent_id: { type: "string", enum: undefined } },
                    query_params_schema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                enum: undefined,
                                is_system_provided: false,
                                dynamic_variable: "",
                                constant_value: "",
                            },
                        },
                    },
                    request_body_schema: {},
                    request_headers: { Authorization: "Bearer {api_key}" },
                    auth_connection: { auth_connection_id: "auth_connection_id" },
                },
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            usage_stats: { total_calls: 1, avg_latency_secs: 1.1 },
        };
        server
            .mockEndpoint()
            .post("/v1/convai/tools")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.create({
            toolConfig: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                apiIntegrationId: "api_integration_id",
                apiIntegrationConnectionId: "api_integration_connection_id",
                baseApiSchema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    pathParamsSchema: {
                        agent_id: {
                            type: "string",
                        },
                    },
                    queryParamsSchema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                isSystemProvided: false,
                                dynamicVariable: "",
                                constantValue: "",
                            },
                        },
                    },
                    requestBodySchema: {},
                    requestHeaders: {
                        Authorization: "Bearer {api_key}",
                    },
                },
            },
        });
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                disableInterruptions: true,
                forcePreToolSpeech: true,
                assignments: [
                    {
                        source: "response",
                        dynamicVariable: "user_name",
                        valuePath: "user.name",
                    },
                ],
                toolCallSound: "typing",
                toolCallSoundBehavior: "auto",
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
                executionMode: "immediate",
                toolVersion: "tool_version",
                apiIntegrationId: "api_integration_id",
                apiIntegrationConnectionId: "api_integration_connection_id",
                apiSchemaOverrides: {
                    pathParamsSchema: {},
                    queryParamsSchema: {
                        properties: undefined,
                        required: undefined,
                    },
                    requestBodySchema: {
                        description: undefined,
                        properties: undefined,
                        required: undefined,
                    },
                    requestHeaders: {},
                },
                baseApiSchema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    pathParamsSchema: {
                        agent_id: {
                            type: "string",
                            enum: undefined,
                        },
                    },
                    queryParamsSchema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                enum: undefined,
                                isSystemProvided: false,
                                dynamicVariable: "",
                                constantValue: "",
                            },
                        },
                    },
                    requestBodySchema: {},
                    requestHeaders: {
                        Authorization: "Bearer {api_key}",
                    },
                    authConnection: {
                        authConnectionId: "auth_connection_id",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            usageStats: {
                totalCalls: 1,
                avgLatencySecs: 1.1,
            },
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            tool_config: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                disable_interruptions: true,
                force_pre_tool_speech: true,
                assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                tool_call_sound: "typing",
                tool_call_sound_behavior: "auto",
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                execution_mode: "immediate",
                tool_version: "tool_version",
                api_integration_id: "api_integration_id",
                api_integration_connection_id: "api_integration_connection_id",
                api_schema_overrides: {
                    path_params_schema: {},
                    query_params_schema: { properties: undefined, required: undefined },
                    request_body_schema: { description: undefined, properties: undefined, required: undefined },
                    request_headers: {},
                },
                base_api_schema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    path_params_schema: { agent_id: { type: "string", enum: undefined } },
                    query_params_schema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                enum: undefined,
                                is_system_provided: false,
                                dynamic_variable: "",
                                constant_value: "",
                            },
                        },
                    },
                    request_body_schema: {},
                    request_headers: { Authorization: "Bearer {api_key}" },
                    auth_connection: { auth_connection_id: "auth_connection_id" },
                },
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            usage_stats: { total_calls: 1, avg_latency_secs: 1.1 },
        };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.get("tool_id");
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                disableInterruptions: true,
                forcePreToolSpeech: true,
                assignments: [
                    {
                        source: "response",
                        dynamicVariable: "user_name",
                        valuePath: "user.name",
                    },
                ],
                toolCallSound: "typing",
                toolCallSoundBehavior: "auto",
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
                executionMode: "immediate",
                toolVersion: "tool_version",
                apiIntegrationId: "api_integration_id",
                apiIntegrationConnectionId: "api_integration_connection_id",
                apiSchemaOverrides: {
                    pathParamsSchema: {},
                    queryParamsSchema: {
                        properties: undefined,
                        required: undefined,
                    },
                    requestBodySchema: {
                        description: undefined,
                        properties: undefined,
                        required: undefined,
                    },
                    requestHeaders: {},
                },
                baseApiSchema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    pathParamsSchema: {
                        agent_id: {
                            type: "string",
                            enum: undefined,
                        },
                    },
                    queryParamsSchema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                enum: undefined,
                                isSystemProvided: false,
                                dynamicVariable: "",
                                constantValue: "",
                            },
                        },
                    },
                    requestBodySchema: {},
                    requestHeaders: {
                        Authorization: "Bearer {api_key}",
                    },
                    authConnection: {
                        authConnectionId: "auth_connection_id",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            usageStats: {
                totalCalls: 1,
                avgLatencySecs: 1.1,
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.delete("tool_id");
        expect(response).toEqual({
            key: "value",
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            tool_config: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                api_integration_id: "api_integration_id",
                api_integration_connection_id: "api_integration_connection_id",
                base_api_schema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    path_params_schema: { agent_id: { type: "string" } },
                    query_params_schema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                is_system_provided: false,
                                dynamic_variable: "",
                                constant_value: "",
                            },
                        },
                    },
                    request_body_schema: {},
                    request_headers: { Authorization: "Bearer {api_key}" },
                },
            },
        };
        const rawResponseBody = {
            id: "id",
            tool_config: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                disable_interruptions: true,
                force_pre_tool_speech: true,
                assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                tool_call_sound: "typing",
                tool_call_sound_behavior: "auto",
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                execution_mode: "immediate",
                tool_version: "tool_version",
                api_integration_id: "api_integration_id",
                api_integration_connection_id: "api_integration_connection_id",
                api_schema_overrides: {
                    path_params_schema: {},
                    query_params_schema: { properties: undefined, required: undefined },
                    request_body_schema: { description: undefined, properties: undefined, required: undefined },
                    request_headers: {},
                },
                base_api_schema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    path_params_schema: { agent_id: { type: "string", enum: undefined } },
                    query_params_schema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                enum: undefined,
                                is_system_provided: false,
                                dynamic_variable: "",
                                constant_value: "",
                            },
                        },
                    },
                    request_body_schema: {},
                    request_headers: { Authorization: "Bearer {api_key}" },
                    auth_connection: { auth_connection_id: "auth_connection_id" },
                },
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            usage_stats: { total_calls: 1, avg_latency_secs: 1.1 },
        };
        server
            .mockEndpoint()
            .patch("/v1/convai/tools/tool_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.update("tool_id", {
            toolConfig: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                apiIntegrationId: "api_integration_id",
                apiIntegrationConnectionId: "api_integration_connection_id",
                baseApiSchema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    pathParamsSchema: {
                        agent_id: {
                            type: "string",
                        },
                    },
                    queryParamsSchema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                isSystemProvided: false,
                                dynamicVariable: "",
                                constantValue: "",
                            },
                        },
                    },
                    requestBodySchema: {},
                    requestHeaders: {
                        Authorization: "Bearer {api_key}",
                    },
                },
            },
        });
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "api_integration_webhook",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                disableInterruptions: true,
                forcePreToolSpeech: true,
                assignments: [
                    {
                        source: "response",
                        dynamicVariable: "user_name",
                        valuePath: "user.name",
                    },
                ],
                toolCallSound: "typing",
                toolCallSoundBehavior: "auto",
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
                executionMode: "immediate",
                toolVersion: "tool_version",
                apiIntegrationId: "api_integration_id",
                apiIntegrationConnectionId: "api_integration_connection_id",
                apiSchemaOverrides: {
                    pathParamsSchema: {},
                    queryParamsSchema: {
                        properties: undefined,
                        required: undefined,
                    },
                    requestBodySchema: {
                        description: undefined,
                        properties: undefined,
                        required: undefined,
                    },
                    requestHeaders: {},
                },
                baseApiSchema: {
                    url: "https://example.com/agents/{agent_id}",
                    method: "GET",
                    pathParamsSchema: {
                        agent_id: {
                            type: "string",
                            enum: undefined,
                        },
                    },
                    queryParamsSchema: {
                        properties: {
                            key: {
                                type: "string",
                                description: "My property",
                                enum: undefined,
                                isSystemProvided: false,
                                dynamicVariable: "",
                                constantValue: "",
                            },
                        },
                    },
                    requestBodySchema: {},
                    requestHeaders: {
                        Authorization: "Bearer {api_key}",
                    },
                    authConnection: {
                        authConnectionId: "auth_connection_id",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            usageStats: {
                totalCalls: 1,
                avgLatencySecs: 1.1,
            },
        });
    });

    test("get_dependent_agents", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            agents: [{ type: "available", id: "id", name: "name", created_at_unix_secs: 1, access_level: "admin" }],
            next_cursor: "next_cursor",
            has_more: true,
        };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id/dependent-agents")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.getDependentAgents("tool_id", {
            cursor: "cursor",
            pageSize: 1,
        });
        expect(response).toEqual({
            agents: [
                {
                    type: "available",
                    id: "id",
                    name: "name",
                    createdAtUnixSecs: 1,
                    accessLevel: "admin",
                },
            ],
            nextCursor: "next_cursor",
            hasMore: true,
        });
    });
});
