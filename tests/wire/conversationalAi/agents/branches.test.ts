// This file was auto-generated by Fern from our API Definition.

import { ElevenLabsClient } from "../../../../src/Client";
import { mockServerPool } from "../../../mock-server/MockServerPool";

describe("BranchesClient", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            meta: { total: 1, page: 1, page_size: 1 },
            results: [
                {
                    id: "id",
                    name: "name",
                    agent_id: "agent_id",
                    description: "description",
                    created_at: 1,
                    last_committed_at: 1,
                    is_archived: true,
                    protection_status: "writer_perms_required",
                    access_info: {
                        is_creator: true,
                        creator_name: "John Doe",
                        creator_email: "john.doe@example.com",
                        role: "admin",
                    },
                    current_live_percentage: 1.1,
                    draft_exists: true,
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v1/convai/agents/agent_3701k3ttaq12ewp8b7qv5rfyszkz/branches")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.agents.branches.list("agent_3701k3ttaq12ewp8b7qv5rfyszkz", {
            includeArchived: true,
            limit: 1,
        });
        expect(response).toEqual({
            meta: {
                total: 1,
                page: 1,
                pageSize: 1,
            },
            results: [
                {
                    id: "id",
                    name: "name",
                    agentId: "agent_id",
                    description: "description",
                    createdAt: 1,
                    lastCommittedAt: 1,
                    isArchived: true,
                    protectionStatus: "writer_perms_required",
                    accessInfo: {
                        isCreator: true,
                        creatorName: "John Doe",
                        creatorEmail: "john.doe@example.com",
                        role: "admin",
                    },
                    currentLivePercentage: 1.1,
                    draftExists: true,
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { parent_version_id: "parent_version_id", name: "name", description: "description" };
        const rawResponseBody = { created_branch_id: "created_branch_id", created_version_id: "created_version_id" };
        server
            .mockEndpoint()
            .post("/v1/convai/agents/agent_3701k3ttaq12ewp8b7qv5rfyszkz/branches")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.agents.branches.create("agent_3701k3ttaq12ewp8b7qv5rfyszkz", {
            parentVersionId: "parent_version_id",
            name: "name",
            description: "description",
        });
        expect(response).toEqual({
            createdBranchId: "created_branch_id",
            createdVersionId: "created_version_id",
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            name: "name",
            agent_id: "agent_id",
            description: "description",
            created_at: 1,
            last_committed_at: 1,
            is_archived: true,
            protection_status: "writer_perms_required",
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            current_live_percentage: 1.1,
            parent_branch: { id: "id", name: "name" },
            most_recent_versions: [
                {
                    id: "id",
                    agent_id: "agent_id",
                    branch_id: "branch_id",
                    version_description: "version_description",
                    seq_no_in_branch: 1,
                    time_committed_secs: 1,
                    parents: {},
                    access_info: {
                        is_creator: true,
                        creator_name: "John Doe",
                        creator_email: "john.doe@example.com",
                        role: "admin",
                    },
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v1/convai/agents/agent_3701k3ttaq12ewp8b7qv5rfyszkz/branches/agtbranch_0901k4aafjxxfxt93gd841r7tv5t")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.agents.branches.get(
            "agent_3701k3ttaq12ewp8b7qv5rfyszkz",
            "agtbranch_0901k4aafjxxfxt93gd841r7tv5t",
        );
        expect(response).toEqual({
            id: "id",
            name: "name",
            agentId: "agent_id",
            description: "description",
            createdAt: 1,
            lastCommittedAt: 1,
            isArchived: true,
            protectionStatus: "writer_perms_required",
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            currentLivePercentage: 1.1,
            parentBranch: {
                id: "id",
                name: "name",
            },
            mostRecentVersions: [
                {
                    id: "id",
                    agentId: "agent_id",
                    branchId: "branch_id",
                    versionDescription: "version_description",
                    seqNoInBranch: 1,
                    timeCommittedSecs: 1,
                    parents: {},
                    accessInfo: {
                        isCreator: true,
                        creatorName: "John Doe",
                        creatorEmail: "john.doe@example.com",
                        role: "admin",
                    },
                },
            ],
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {
            id: "id",
            name: "name",
            agent_id: "agent_id",
            description: "description",
            created_at: 1,
            last_committed_at: 1,
            is_archived: true,
            protection_status: "writer_perms_required",
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            current_live_percentage: 1.1,
            parent_branch: { id: "id", name: "name" },
            most_recent_versions: [
                {
                    id: "id",
                    agent_id: "agent_id",
                    branch_id: "branch_id",
                    version_description: "version_description",
                    seq_no_in_branch: 1,
                    time_committed_secs: 1,
                    parents: {},
                    access_info: {
                        is_creator: true,
                        creator_name: "John Doe",
                        creator_email: "john.doe@example.com",
                        role: "admin",
                    },
                },
            ],
        };
        server
            .mockEndpoint()
            .patch(
                "/v1/convai/agents/agent_3701k3ttaq12ewp8b7qv5rfyszkz/branches/agtbranch_0901k4aafjxxfxt93gd841r7tv5t",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.agents.branches.update(
            "agent_3701k3ttaq12ewp8b7qv5rfyszkz",
            "agtbranch_0901k4aafjxxfxt93gd841r7tv5t",
        );
        expect(response).toEqual({
            id: "id",
            name: "name",
            agentId: "agent_id",
            description: "description",
            createdAt: 1,
            lastCommittedAt: 1,
            isArchived: true,
            protectionStatus: "writer_perms_required",
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            currentLivePercentage: 1.1,
            parentBranch: {
                id: "id",
                name: "name",
            },
            mostRecentVersions: [
                {
                    id: "id",
                    agentId: "agent_id",
                    branchId: "branch_id",
                    versionDescription: "version_description",
                    seqNoInBranch: 1,
                    timeCommittedSecs: 1,
                    parents: {},
                    accessInfo: {
                        isCreator: true,
                        creatorName: "John Doe",
                        creatorEmail: "john.doe@example.com",
                        role: "admin",
                    },
                },
            ],
        });
    });

    test("merge", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post(
                "/v1/convai/agents/agent_3701k3ttaq12ewp8b7qv5rfyszkz/branches/agtbrch_8901k4t9z5defmb8vh3e9361y7nj/merge",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.agents.branches.merge(
            "agent_3701k3ttaq12ewp8b7qv5rfyszkz",
            "agtbrch_8901k4t9z5defmb8vh3e9361y7nj",
            {
                targetBranchId: "agtbrch_8901k4t9z5defmb8vh3e9361y7nj",
            },
        );
        expect(response).toEqual({
            key: "value",
        });
    });
});
