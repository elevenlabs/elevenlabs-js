// This file was auto-generated by Fern from our API Definition.

import { ElevenLabsClient } from "../../../src/Client";
import { mockServerPool } from "../../mock-server/MockServerPool";

describe("BatchCallsClient", () => {
    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { call_name: "call_name", agent_id: "agent_id", recipients: [{}] };
        const rawResponseBody = {
            id: "id",
            phone_number_id: "phone_number_id",
            phone_provider: "twilio",
            whatsapp_params: {
                whatsapp_phone_number_id: "whatsapp_phone_number_id",
                whatsapp_call_permission_request_template_name: "whatsapp_call_permission_request_template_name",
                whatsapp_call_permission_request_template_language_code:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agent_id: "agent_id",
            created_at_unix: 1,
            scheduled_time_unix: 1,
            timezone: "timezone",
            total_calls_dispatched: 1,
            total_calls_scheduled: 1,
            total_calls_finished: 1,
            last_updated_at_unix: 1,
            status: "pending",
            retry_count: 1,
            agent_name: "agent_name",
        };
        server
            .mockEndpoint()
            .post("/v1/convai/batch-calling/submit")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.batchCalls.create({
            callName: "call_name",
            agentId: "agent_id",
            recipients: [{}],
        });
        expect(response).toEqual({
            id: "id",
            phoneNumberId: "phone_number_id",
            phoneProvider: "twilio",
            whatsappParams: {
                whatsappPhoneNumberId: "whatsapp_phone_number_id",
                whatsappCallPermissionRequestTemplateName: "whatsapp_call_permission_request_template_name",
                whatsappCallPermissionRequestTemplateLanguageCode:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agentId: "agent_id",
            createdAtUnix: 1,
            scheduledTimeUnix: 1,
            timezone: "timezone",
            totalCallsDispatched: 1,
            totalCallsScheduled: 1,
            totalCallsFinished: 1,
            lastUpdatedAtUnix: 1,
            status: "pending",
            retryCount: 1,
            agentName: "agent_name",
        });
    });

    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            batch_calls: [
                {
                    id: "id",
                    phone_number_id: "phone_number_id",
                    phone_provider: "twilio",
                    whatsapp_params: {
                        whatsapp_call_permission_request_template_name:
                            "whatsapp_call_permission_request_template_name",
                        whatsapp_call_permission_request_template_language_code:
                            "whatsapp_call_permission_request_template_language_code",
                    },
                    name: "name",
                    agent_id: "agent_id",
                    created_at_unix: 1,
                    scheduled_time_unix: 1,
                    timezone: "timezone",
                    total_calls_dispatched: 1,
                    total_calls_scheduled: 1,
                    total_calls_finished: 1,
                    last_updated_at_unix: 1,
                    status: "pending",
                    retry_count: 1,
                    agent_name: "agent_name",
                },
            ],
            next_doc: "next_doc",
            has_more: true,
        };
        server
            .mockEndpoint()
            .get("/v1/convai/batch-calling/workspace")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.batchCalls.list({
            limit: 1,
            lastDoc: "last_doc",
        });
        expect(response).toEqual({
            batchCalls: [
                {
                    id: "id",
                    phoneNumberId: "phone_number_id",
                    phoneProvider: "twilio",
                    whatsappParams: {
                        whatsappCallPermissionRequestTemplateName: "whatsapp_call_permission_request_template_name",
                        whatsappCallPermissionRequestTemplateLanguageCode:
                            "whatsapp_call_permission_request_template_language_code",
                    },
                    name: "name",
                    agentId: "agent_id",
                    createdAtUnix: 1,
                    scheduledTimeUnix: 1,
                    timezone: "timezone",
                    totalCallsDispatched: 1,
                    totalCallsScheduled: 1,
                    totalCallsFinished: 1,
                    lastUpdatedAtUnix: 1,
                    status: "pending",
                    retryCount: 1,
                    agentName: "agent_name",
                },
            ],
            nextDoc: "next_doc",
            hasMore: true,
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            phone_number_id: "phone_number_id",
            phone_provider: "twilio",
            whatsapp_params: {
                whatsapp_phone_number_id: "whatsapp_phone_number_id",
                whatsapp_call_permission_request_template_name: "whatsapp_call_permission_request_template_name",
                whatsapp_call_permission_request_template_language_code:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agent_id: "agent_id",
            created_at_unix: 1,
            scheduled_time_unix: 1,
            timezone: "timezone",
            total_calls_dispatched: 1,
            total_calls_scheduled: 1,
            total_calls_finished: 1,
            last_updated_at_unix: 1,
            status: "pending",
            retry_count: 1,
            agent_name: "agent_name",
            recipients: [
                {
                    id: "id",
                    phone_number: "phone_number",
                    whatsapp_user_id: "whatsapp_user_id",
                    status: "pending",
                    created_at_unix: 1,
                    updated_at_unix: 1,
                    conversation_id: "conversation_id",
                    conversation_initiation_client_data: {
                        conversation_config_override: {
                            turn: { soft_timeout_config: { message: "Hhmmmm...yeah." } },
                            tts: { voice_id: "cjVigY5qzO86Huf0OWal", stability: 0.5, speed: 1, similarity_boost: 0.8 },
                            agent: {
                                first_message: "Hello, how can I help you today?",
                                language: "en",
                                prompt: {
                                    prompt: "You are a helpful assistant that can answer questions about the topic of the conversation.",
                                    llm: "gemini-2.0-flash-001",
                                },
                            },
                        },
                    },
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v1/convai/batch-calling/batch_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.batchCalls.get("batch_id");
        expect(response).toEqual({
            id: "id",
            phoneNumberId: "phone_number_id",
            phoneProvider: "twilio",
            whatsappParams: {
                whatsappPhoneNumberId: "whatsapp_phone_number_id",
                whatsappCallPermissionRequestTemplateName: "whatsapp_call_permission_request_template_name",
                whatsappCallPermissionRequestTemplateLanguageCode:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agentId: "agent_id",
            createdAtUnix: 1,
            scheduledTimeUnix: 1,
            timezone: "timezone",
            totalCallsDispatched: 1,
            totalCallsScheduled: 1,
            totalCallsFinished: 1,
            lastUpdatedAtUnix: 1,
            status: "pending",
            retryCount: 1,
            agentName: "agent_name",
            recipients: [
                {
                    id: "id",
                    phoneNumber: "phone_number",
                    whatsappUserId: "whatsapp_user_id",
                    status: "pending",
                    createdAtUnix: 1,
                    updatedAtUnix: 1,
                    conversationId: "conversation_id",
                    conversationInitiationClientData: {
                        conversationConfigOverride: {
                            turn: {
                                softTimeoutConfig: {
                                    message: "Hhmmmm...yeah.",
                                },
                            },
                            tts: {
                                voiceId: "cjVigY5qzO86Huf0OWal",
                                stability: 0.5,
                                speed: 1,
                                similarityBoost: 0.8,
                            },
                            agent: {
                                firstMessage: "Hello, how can I help you today?",
                                language: "en",
                                prompt: {
                                    prompt: "You are a helpful assistant that can answer questions about the topic of the conversation.",
                                    llm: "gemini-2.0-flash-001",
                                },
                            },
                        },
                    },
                },
            ],
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/v1/convai/batch-calling/batch_id").respondWith().statusCode(200).build();

        const response = await client.conversationalAi.batchCalls.delete("batch_id");
        expect(response).toEqual(undefined);
    });

    test("cancel", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            phone_number_id: "phone_number_id",
            phone_provider: "twilio",
            whatsapp_params: {
                whatsapp_phone_number_id: "whatsapp_phone_number_id",
                whatsapp_call_permission_request_template_name: "whatsapp_call_permission_request_template_name",
                whatsapp_call_permission_request_template_language_code:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agent_id: "agent_id",
            created_at_unix: 1,
            scheduled_time_unix: 1,
            timezone: "timezone",
            total_calls_dispatched: 1,
            total_calls_scheduled: 1,
            total_calls_finished: 1,
            last_updated_at_unix: 1,
            status: "pending",
            retry_count: 1,
            agent_name: "agent_name",
        };
        server
            .mockEndpoint()
            .post("/v1/convai/batch-calling/batch_id/cancel")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.batchCalls.cancel("batch_id");
        expect(response).toEqual({
            id: "id",
            phoneNumberId: "phone_number_id",
            phoneProvider: "twilio",
            whatsappParams: {
                whatsappPhoneNumberId: "whatsapp_phone_number_id",
                whatsappCallPermissionRequestTemplateName: "whatsapp_call_permission_request_template_name",
                whatsappCallPermissionRequestTemplateLanguageCode:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agentId: "agent_id",
            createdAtUnix: 1,
            scheduledTimeUnix: 1,
            timezone: "timezone",
            totalCallsDispatched: 1,
            totalCallsScheduled: 1,
            totalCallsFinished: 1,
            lastUpdatedAtUnix: 1,
            status: "pending",
            retryCount: 1,
            agentName: "agent_name",
        });
    });

    test("retry", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            phone_number_id: "phone_number_id",
            phone_provider: "twilio",
            whatsapp_params: {
                whatsapp_phone_number_id: "whatsapp_phone_number_id",
                whatsapp_call_permission_request_template_name: "whatsapp_call_permission_request_template_name",
                whatsapp_call_permission_request_template_language_code:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agent_id: "agent_id",
            created_at_unix: 1,
            scheduled_time_unix: 1,
            timezone: "timezone",
            total_calls_dispatched: 1,
            total_calls_scheduled: 1,
            total_calls_finished: 1,
            last_updated_at_unix: 1,
            status: "pending",
            retry_count: 1,
            agent_name: "agent_name",
        };
        server
            .mockEndpoint()
            .post("/v1/convai/batch-calling/batch_id/retry")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.batchCalls.retry("batch_id");
        expect(response).toEqual({
            id: "id",
            phoneNumberId: "phone_number_id",
            phoneProvider: "twilio",
            whatsappParams: {
                whatsappPhoneNumberId: "whatsapp_phone_number_id",
                whatsappCallPermissionRequestTemplateName: "whatsapp_call_permission_request_template_name",
                whatsappCallPermissionRequestTemplateLanguageCode:
                    "whatsapp_call_permission_request_template_language_code",
            },
            name: "name",
            agentId: "agent_id",
            createdAtUnix: 1,
            scheduledTimeUnix: 1,
            timezone: "timezone",
            totalCallsDispatched: 1,
            totalCallsScheduled: 1,
            totalCallsFinished: 1,
            lastUpdatedAtUnix: 1,
            status: "pending",
            retryCount: 1,
            agentName: "agent_name",
        });
    });
});
