// This file was auto-generated by Fern from our API Definition.

import { ElevenLabsClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("TextToSpeechClient", () => {
    test("convert_with_timestamps", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "This is a test for the API of ElevenLabs." };
        const rawResponseBody = {
            audio_base64: "base64_encoded_audio_string",
            alignment: {
                characters: ["H", "e", "l", "l", "o"],
                character_start_times_seconds: [0, 0.1, 0.2, 0.3, 0.4],
                character_end_times_seconds: [0.1, 0.2, 0.3, 0.4, 0.5],
            },
            normalized_alignment: {
                characters: ["H", "e", "l", "l", "o"],
                character_start_times_seconds: [0, 0.1, 0.2, 0.3, 0.4],
                character_end_times_seconds: [0.1, 0.2, 0.3, 0.4, 0.5],
            },
        };
        server
            .mockEndpoint()
            .post("/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/with-timestamps")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.textToSpeech.convertWithTimestamps("21m00Tcm4TlvDq8ikWAM", {
            enableLogging: true,
            optimizeStreamingLatency: 1,
            outputFormat: "mp3_22050_32",
            text: "This is a test for the API of ElevenLabs.",
        });
        expect(response).toEqual({
            audioBase64: "base64_encoded_audio_string",
            alignment: {
                characters: ["H", "e", "l", "l", "o"],
                characterStartTimesSeconds: [0, 0.1, 0.2, 0.3, 0.4],
                characterEndTimesSeconds: [0.1, 0.2, 0.3, 0.4, 0.5],
            },
            normalizedAlignment: {
                characters: ["H", "e", "l", "l", "o"],
                characterStartTimesSeconds: [0, 0.1, 0.2, 0.3, 0.4],
                characterEndTimesSeconds: [0.1, 0.2, 0.3, 0.4, 0.5],
            },
        });
    });
});
